<template>
  <div class="home" id="headLine">
      <div ref="headLineChild">
          <header>
                {{ form.title }}
            </header>
          <section>
              <time>{{ form.publishTime }}</time>
              <span
                  v-if="form.author"
                  class="author">{{ form.author }}</span>
              <img
                  v-if="form.viewsCount"
                  src="../../../static/images/icon_viewCount_m.png">
              <span v-if="form.viewsCount">{{ form.viewsCount }}</span>
          </section>
          <div
              v-if="form.contentImg"
              class="content">
              <img
                  v-lazy="form.contentImg"
                  class="contentImg">
          </div>
          <div
              class="artical"
              v-html="form.content"/>
      </div>
      <div
          v-if="form.comments && form.comments.length"
          ref="answerBox"
          class="answer-box">
          <div
              v-if="form.comments && form.comments.length"
              class="all-answer">
              <p>评论<span>{{ form.commentCount?'('+ form.commentCount+')':'' }}</span></p>
              <ul class="answer-ul">
                  <li
                      v-for="(item,index) in form.comments"
                      :key="index">
                      <ol>
                          <li class="headPortrait">
                              <img
                                  v-lazy="item.headUrl? item.headUrl : item.userType == 1 ? '../../../static/images/icon_owner.png' : item.userType == 0 ? '../../../static/images/icon_cargo.png' : '../../../static/images/icon_other.png'">
                              <img
                                  v-if="item.vipStatus == 1"
                                  src="../../../static/images/icon_v.png">
                          </li>
                          <li>
                              <p class="role-font clearfixed">
                                  <span class="nickName">{{ item.nickName }}</span>
                                  <span
                                      v-if="item.socailManagerType || item.userType == 1 || item.userType == 0"
                                      :class="item.socailManagerType == 1 ? 'isSocailManagerType': item.userType !=2? 'noSocailManagerType': null "
                                      class="nickSf">
                                      {{ item.socailManagerType == 1? '官方账号': item.userType == 1 ? '船东' :item.userType == 0 ? '货主' : null }}
                                  </span>
                              </p>
                              <p
                                  v-if="!item.commentedNickName"
                                  class="reply-font">{{ item.content }}</p>
                              <p
                                  v-else
                                  class="reply-font"> 回复 <span> {{ item.commentedNickName }}： </span> {{ item.content }}
                              </p>
                              <p class="answer-foot clearfixed">
                                  <label class="date-btn">{{ formatTime.formatTime(item.createTime) }}</label>
                                  <span
                                      class="reply-btn"
                                      >回复</span>
                                  <span>
                                      <i
                                          :class="item.praised? 'praiseCountStyle' : 'noPraiseCountStyle'"
                                      />{{ item.praiseCount }}
                                  </span>
                              </p>
                          </li>
                      </ol>
                  </li>
              </ul>
          </div>
          <div
              v-if="form.commentCount==0"
              class="noComment">
              当前没有评论，快抢沙发
          </div>
      </div>
  </div>
</template>

<script>
import { mapActions, mapGetters } from 'vuex'
import CONST_REQUEST from '../../constants/request'
import formatTime from '../../utill/formatTime.js'
export default {
  data () {
    return {
      CONST_REQUEST,
      formatTime
      // value1: undefined,
      // value2: undefined,
      // value3: undefined
    }
  },
  computed: {
    ...mapGetters('home', ['headLineList', 'headLineListStatus', 'headDetails', 'headDetailStatus']),
    loading () {
      return this.headDetailStatus.code === CONST_REQUEST.LOADING
    },
    failure () {
      return this.headDetailStatus.code === CONST_REQUEST.FAILURE
    },
    failureMsg () {
      return this.headDetailStatus.msg
    },
    form () {
      if (this.headDetails) {
        return this.headDetails
      } else {
        return false
      }
    }
  },
  methods: {
    ...mapActions('home', ['getquery', 'getHeadDetail'])
  },
  mounted () {
    window.xxx = this
    document.cookie = 'token=;path=/'
    // this.getquery({ channelId: 99, pageSize: 10 })
    this.getHeadDetail({ id: 75 })
  }
}
</script>
<style lang="less" scoped>
* {
    padding: 0;
    margin: 0;
    box-sizing: border-box;
}
#headLine {
    width: 100%;
    padding: 5px 0 0;
    background: #fff;

    header {
        margin: -6px 0 5px 0;
        line-height: 30px;
        font-size: 18px;
        font-weight: bold;
        padding: 10px 20px;
    }

    section {
        color: #666;
        margin-bottom: 10px;
        height: 20px;
        padding: 0 20px;
        line-height: 20px;
        font-size: 12px;
        display: flex;
        align-items: center;

        .author {
            flex: 1;
            margin-left: 15px;
            margin-right: 5px;
            width: 200px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        & > i {
            line-height: 20px;
        }

        img {
            margin-right: 5px;
            width: 15px;
            height: 13px;
        }
    }

    .content {
        width: 100%;
        padding: 0 20px;

        .contentImg {
            width: 100%;
            border-radius: 10px;
        }
    }

    .artical {
        width: 100%;
        padding: 0 20px 0;
        background: #fff;
    }

    .answer-box {
        width: 100%;
        overflow: auto;
        -webkit-overflow-scrolling: touch;
        margin-top: 10px;
        background: #fff;

        .all-answer {
            background: #fff;
            padding-left: 20px;
            margin-top: 10px;

            & > p {
                text-align: left;
                line-height: 50px;
                font-size: 14px;
                border-bottom: 1px solid #ddd;
            }

            .answer-ul {
                li {
                    ol {
                        display: flex;
                        padding: 20px 0 0;

                        & > li {
                            p {
                                line-height: 25px;
                            }

                            .reply-font {
                                font-size: 15px;
                                color: #333;
                                word-break: break-all;
                                word-wrap: break-word;

                                span {
                                    font-weight: bolder;
                                }
                            }

                            .role-font {
                                // height: 23px;
                                height: auto;
                                line-height: 23px;

                                .nickName {
                                    font-size: 17px;
                                    color: #333;
                                    margin-right: 5px;
                                    font-weight: bolder;
                                }

                                .nickSf {
                                    vertical-align: text-top;
                                    color: #fff;
                                    display: inline-block;
                                    padding: 0 5px;
                                    line-height: 18px;
                                    border-radius: 4px;
                                    font-size: 12px;
                                    letter-spacing: 0;
                                }

                                .isSocailManagerType {
                                    background: #ee7c0c;
                                }

                                .noSocailManagerType {
                                    background: #0062fd;
                                }
                            }

                            .answer-foot {
                                width: 100%;
                                font-size: 12px;
                                margin-top: 10px;

                                .date-btn {
                                    color: #666;
                                }

                                span:last-child {
                                    float: right;
                                    display: flex;
                                }

                                .reply-btn {
                                    color: #0062fd;
                                    display: inline-block;
                                    width: 35px;
                                    text-align: right;
                                }

                                .praiseCountStyle {
                                    height: 25px;
                                    line-height: 25px;
                                    width: 20px;
                                    background: url(../../../static/images/icon_g2_m.png) no-repeat;
                                    background-size: 85%;
                                }

                                .noPraiseCountStyle {
                                    height: 25px;
                                    line-height: 25px;
                                    width: 20px;
                                    background: url(../../../static/images/icon_g_m.png) no-repeat;
                                    background-size: 85%;
                                }
                            }
                        }

                        & > li:nth-child(2) {
                            text-align: left;
                            flex: 1;
                            padding-right: 30px;
                            padding-bottom: 20px;
                            box-sizing: border-box;
                            border-bottom: 1px solid #ddd;

                            i {
                                display: inline-block;
                                width: 20px;
                                font-size: 15px;
                            }
                        }

                        .headPortrait {
                            width: 50px;
                            height: 50px;
                            margin-right: 15px;
                            position: relative;

                            img:first-child {
                                width: 100%;
                                border-radius: 50%;
                            }

                            img:nth-child(2) {
                                position: absolute;
                                bottom: 0;
                                right: 0;
                                width: 36%;
                            }
                        }
                    }
                }

                & > li:last-child {
                    ol > li {
                        border-bottom: 0;
                    }
                }
            }
        }

        .noComment {
            text-align: center;
            font-size: 15px;
            color: #333;
            margin: 50px 0;
        }
    }
}
</style>
<style>
    .artical p {
        line-height: 30px;
        word-wrap: break-word;
        word-break: break-all;
    }

    .artical img {
        max-width: 100%;
        width: 100%;
    }

    .clearfixed::after {
        clear: both;
        display: table;
        content: '';
    }
</style>
